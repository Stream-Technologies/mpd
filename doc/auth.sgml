<!-- $Id: auth.sgml,v 1.9 2007/05/28 14:25:57 amotin Exp $ -->
<!-- mpd netgraph enabled user mode PPP daemon -->

<!-- <!DOCTYPE linuxdoc PUBLIC '-//FreeBSD//DTD linuxdoc//EN'> -->

  <sect><heading>Auth commands<label id="auth"></heading>

<p>

  This chapter describes commands that configure the Authentication 
  subsystem of LCP layer. All of these commands apply to the currently
  active link. Mpd currently supports authentication against (tried 
  in this order) RADIUS, systems password database (<tt>master.passwd</tt>), 
  OPIE and its integrated <tt>mpd.secrets</tt> file.

<descrip>

<tag><tt>
set auth authname <em>login</em>
</tt></tag>

This command sets the authentication login name associated with
the link (in multi-link PPP, though each link is authenticated
individually, they all must use the same login name). The
<tt><em>login</em></tt> must have a corresponding entry in
<tt>mpd.secrets</tt>. The <tt><em>login</em></tt> and password
are used when the peer requires us to authenticate ourselves.

<tag><tt>
set auth password <em>password</em>
</tt></tag>

This command is normally not necessary. It causes mpd to <em>not</em>
lookup the password corresponding to
<tt><em>login</em></tt> in <tt>mpd.secrets</tt>, but rather to use
<tt><em>password</em></tt> instead. If you're too lazy to set up
<tt>mpd.secrets</tt> and are only dialing out, you can use this
command instead.

<tag><tt>set auth max-logins <em>num</em></tt></tag>

Limit the max. amount of concurrent logins with the same username.
If set to zero, then this feature is disabled.

<tag><tt>set auth acct-update <em>seconds</em></tt></tag>

Enables periodic accounting updates, if set to a value greater then 
zero.

<tag><tt>set auth timeout <em>seconds</em></tt></tag>

Sets the timeout for the whole authentication process.
It defaults to 40 seconds. 
Under some circumstances the value should be changed; it usually 
depends on the authentication backend and protocol.
E.g. when using EAP with a slow RADIUS server this value should be increased.

<tag><tt>
<newline>set auth enable <em>option ...</em>
<newline>set auth disable <em>option ...</em>
</tt></tag>

</descrip>

<p>

The options available are:

<descrip>

<tag><tt>internal</tt></tag>

Enables authentication against the <tt>mpd.secrets</tt> file.

Default <tt><bf>enable</bf></tt>.

<tag><tt>radius-auth</tt></tag>

Enable authentication via RADIUS.

Default <tt><bf>disable</bf></tt>.

<tag><tt>radius-acct</tt></tag>

Enable per link accounting via RADIUS.

Default <tt><bf>disable</bf></tt>.

<tag><tt>ext-auth</tt></tag>

Enable authentication by calling external authentination script.
This method pretended to be a fullfeatured alternative to the 
<tt><bf>radius-auth</bf></tt>.

Path to that script must be specified using <tt><bf>set auth extauth-script ...</bf></tt>
command.

On invocation this script receives on stdin set of request 
attribute:value pairs terminated by empty line and generates 
response in same format on stdout.

Currently supported request attributes:
<verb>
USER_NAME
USER_PASSWORD - for PAP only
NAS_PORT
NAS_PORT_TYPE
CALLING_STATION_ID
CALLED_STATION_ID
PEER_ADDR
PEER_PORT
</verb>

Currently supported response attributes:
<verb>
RESULT - one of SUCCESS, UNDEF (if valid USER_PASSWORD returned) or FAIL
USER_NAME
USER_PASSWORD
FRAMED_IP_ADDRESS
FRAMED_ROUTE
FRAMED_IPV6_ROUTE
FRAMED_MTU
SESSION_TIMEOUT
IDLE_TIMEOUT
REPLY_MESSAGE
MPD_RULE
MPD_PIPE
MPD_QUEUE
MPD_TABLE
MPD_TABLE_STATIC
MPD_FILTER
MPD_LIMIT
</verb>

For most of attributes description look their RADIUS alternatives.

Default <tt><bf>disable</bf></tt>.

<tag><tt>system</tt></tag>

Enables authentication against the systems password database.
This options can only be used with PAP and MS-CHAP, but not 
with CHAP-MD5. If you intend to use this with MS-CHAP, then 
the passwords in the <tt>master.passwd</tt> must be NT-Hashes.
You can enable this by putting <tt>:passwd_format=nth:</tt> into 
your <tt>/etc/login.conf</tt>, but you need at least FreeBSD 5.2.

Default <tt><bf>disable</bf></tt>.

<tag><tt>opie</tt></tag>

Enables authentication using OPIE.
When using PAP there is nothing more todo. For all other 
authentication protocols you have to put the username into 
the <tt>mpd.secrets</tt> file, but the specified password is 
then interpreted as secret pass phrase. This is needed, because
Mpd must be aware of the plaintext password when using CHAP.
The (windows) endusers could generate their actual responses 
themselfs using Winkey.
<newline>
<bf>IMPORTANT</bf>: Disable the internal authentication when using 
OPIE and CHAP, because otherwise users are also able to authenticate 
with their secret pass phrase.

Default <tt><bf>disable</bf></tt>.

<tag><tt>utmp-wtmp</tt></tag>

Enable accounting via utmp/wtmp.

Default <tt><bf>disable</bf></tt>.

</descrip>
</p>


